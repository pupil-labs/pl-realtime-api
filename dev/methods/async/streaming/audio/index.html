
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python Client for the Pupil Labs Real-Time API">
      
      
      
        <link rel="canonical" href="https://pupil-labs.github.io/pl-realtime-api/dev/methods/async/streaming/audio/">
      
      
        <link rel="prev" href="../eye-events/">
      
      
        <link rel="next" href="../../templates/">
      
      
      <link rel="icon" href="../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Audio - Pupil Labs Real-Time Python API Client</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_markdown_exec_pyodide.css">
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/material.css">
    
      <link rel="stylesheet" href="../../../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/badges.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stream-audio" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Pupil Labs Real-Time Python API Client" class="md-header__button md-logo" aria-label="Pupil Labs Real-Time Python API Client" data-md-component="logo">
      <!-- Logo -->
<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 155.38 31">
	<path
		d="M0 16c0 8.84 7.16 16 16 16s16-7.16 16-16S24.84 0 16 0 0 7.16 0 16zm28.56 0c0 6.93-5.64 12.56-12.56 12.56S3.44 22.93 3.44 16 9.07 3.44 16 3.44 28.56 9.07 28.56 16z"
	/>
	<path
		d="M4.56 16c0 6.31 5.13 11.44 11.44 11.44S27.44 22.31 27.44 16 22.31 4.56 16 4.56 4.56 9.69 4.56 16zM24 16c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8 8 3.58 8 8z"
	/>
	<path
		d="M102.65 23.99V8h3v13.32h8.93v2.67h-11.93zM126.36 23.99l-.07-1.68h-.05c-.85 1.2-2.33 1.93-4.23 1.93-3.35 0-5.8-2.55-5.8-6.1s2.45-6.13 5.8-6.13c1.9 0 3.35.72 4.2 1.93h.05l.1-1.68h2.2v11.73h-2.2zm-.38-5.85c0-2.23-1.45-3.75-3.55-3.75-2.1 0-3.55 1.52-3.55 3.75 0 2.17 1.45 3.72 3.55 3.72 2.1.01 3.55-1.54 3.55-3.72zM143.92 18.14c0 3.55-2.45 6.1-5.8 6.1-1.93 0-3.38-.72-4.23-1.93h-.05l-.07 1.68h-2.23V8h2.65v5.52h.05c.88-.95 2.17-1.5 3.88-1.5 3.35 0 5.8 2.57 5.8 6.12zm-2.67 0c0-2.23-1.47-3.75-3.55-3.75-2.1 0-3.58 1.52-3.58 3.75 0 2.17 1.47 3.72 3.58 3.72 2.07.01 3.55-1.54 3.55-3.72zM154.63 12.87v2.72h-.12c-.8-.82-2.02-1.25-3.55-1.25-1.27 0-2.17.58-2.17 1.4 0 .67.53.97 2.25 1.07 3.13.18 4.35 1.33 4.35 3.7 0 2.3-1.78 3.72-4.7 3.72-1.95 0-3.48-.4-4.45-1.15V20.3h.13c.98 1.05 2.4 1.6 4.2 1.6 1.38 0 2.23-.55 2.23-1.4 0-.78-.53-1.13-2.43-1.28-3.05-.25-4.17-1.2-4.17-3.43 0-2.3 1.87-3.8 4.7-3.8 1.51.03 2.88.33 3.73.88z"
	/>
	<path
		d="M51.25 8c4.03 0 6.1 1.82 6.1 5.37 0 3.52-2.08 5.35-6.1 5.35h-3.58v5.27h-3V8h6.58zm-.12 8.05c2.17 0 3.2-.87 3.2-2.67 0-1.82-1.03-2.7-3.2-2.7h-3.45v5.37h3.45zM68.52 23.99l-.1-1.78h-.05c-.75 1.3-2.08 2.02-3.93 2.02-2.95 0-4.7-1.9-4.7-5.1v-6.91h2.65v6.61c0 1.9 1 3.02 2.73 3.02 1.87 0 2.98-1.3 2.98-3.45v-6.18h2.65v11.76h-2.23zM94.01 8h2.65v15.99h-2.65V8zM90.96 12.24V24h-2.65V12.24h2.65zM86 18.14c0 3.55-2.45 6.1-5.8 6.1-1.7 0-3-.55-3.87-1.5h-.05v5.52h-2.65V12.24h2.23l.07 1.68h.05c.85-1.2 2.3-1.93 4.23-1.93 3.34 0 5.79 2.6 5.79 6.15zm-2.67-.03c0-2.23-1.47-3.75-3.55-3.75-2.1 0-3.58 1.53-3.58 3.75 0 2.17 1.48 3.75 3.58 3.75 2.07.01 3.55-1.57 3.55-3.75zM88.31 8h2.65v2.65h-2.65z"
	/>
</svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pupil Labs Real-Time Python API Client
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Audio
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/pupil-labs/pl-realtime-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pupil-labs/pl-realtime-api
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../simple/" class="md-tabs__link">
          
  
  
    
  
  Simple API

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Async API

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../modules/" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../guides/under-the-hood/" class="md-tabs__link">
        
  
  
    
  
  Under the Hood

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../cookbook/" class="md-tabs__link">
          
  
  
    
  
  Cookbook

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Pupil Labs Real-Time Python API Client" class="md-nav__button md-logo" aria-label="Pupil Labs Real-Time Python API Client" data-md-component="logo">
      <!-- Logo -->
<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 155.38 31">
	<path
		d="M0 16c0 8.84 7.16 16 16 16s16-7.16 16-16S24.84 0 16 0 0 7.16 0 16zm28.56 0c0 6.93-5.64 12.56-12.56 12.56S3.44 22.93 3.44 16 9.07 3.44 16 3.44 28.56 9.07 28.56 16z"
	/>
	<path
		d="M4.56 16c0 6.31 5.13 11.44 11.44 11.44S27.44 22.31 27.44 16 22.31 4.56 16 4.56 4.56 9.69 4.56 16zM24 16c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8 8 3.58 8 8z"
	/>
	<path
		d="M102.65 23.99V8h3v13.32h8.93v2.67h-11.93zM126.36 23.99l-.07-1.68h-.05c-.85 1.2-2.33 1.93-4.23 1.93-3.35 0-5.8-2.55-5.8-6.1s2.45-6.13 5.8-6.13c1.9 0 3.35.72 4.2 1.93h.05l.1-1.68h2.2v11.73h-2.2zm-.38-5.85c0-2.23-1.45-3.75-3.55-3.75-2.1 0-3.55 1.52-3.55 3.75 0 2.17 1.45 3.72 3.55 3.72 2.1.01 3.55-1.54 3.55-3.72zM143.92 18.14c0 3.55-2.45 6.1-5.8 6.1-1.93 0-3.38-.72-4.23-1.93h-.05l-.07 1.68h-2.23V8h2.65v5.52h.05c.88-.95 2.17-1.5 3.88-1.5 3.35 0 5.8 2.57 5.8 6.12zm-2.67 0c0-2.23-1.47-3.75-3.55-3.75-2.1 0-3.58 1.52-3.58 3.75 0 2.17 1.47 3.72 3.58 3.72 2.07.01 3.55-1.54 3.55-3.72zM154.63 12.87v2.72h-.12c-.8-.82-2.02-1.25-3.55-1.25-1.27 0-2.17.58-2.17 1.4 0 .67.53.97 2.25 1.07 3.13.18 4.35 1.33 4.35 3.7 0 2.3-1.78 3.72-4.7 3.72-1.95 0-3.48-.4-4.45-1.15V20.3h.13c.98 1.05 2.4 1.6 4.2 1.6 1.38 0 2.23-.55 2.23-1.4 0-.78-.53-1.13-2.43-1.28-3.05-.25-4.17-1.2-4.17-3.43 0-2.3 1.87-3.8 4.7-3.8 1.51.03 2.88.33 3.73.88z"
	/>
	<path
		d="M51.25 8c4.03 0 6.1 1.82 6.1 5.37 0 3.52-2.08 5.35-6.1 5.35h-3.58v5.27h-3V8h6.58zm-.12 8.05c2.17 0 3.2-.87 3.2-2.67 0-1.82-1.03-2.7-3.2-2.7h-3.45v5.37h3.45zM68.52 23.99l-.1-1.78h-.05c-.75 1.3-2.08 2.02-3.93 2.02-2.95 0-4.7-1.9-4.7-5.1v-6.91h2.65v6.61c0 1.9 1 3.02 2.73 3.02 1.87 0 2.98-1.3 2.98-3.45v-6.18h2.65v11.76h-2.23zM94.01 8h2.65v15.99h-2.65V8zM90.96 12.24V24h-2.65V12.24h2.65zM86 18.14c0 3.55-2.45 6.1-5.8 6.1-1.7 0-3-.55-3.87-1.5h-.05v5.52h-2.65V12.24h2.23l.07 1.68h.05c.85-1.2 2.3-1.93 4.23-1.93 3.34 0 5.79 2.6 5.79 6.15zm-2.67-.03c0-2.23-1.47-3.75-3.55-3.75-2.1 0-3.58 1.53-3.58 3.75 0 2.17 1.48 3.75 3.58 3.75 2.07.01 3.55-1.57 3.55-3.75zM88.31 8h2.65v2.65h-2.65z"
	/>
</svg>
    </a>
    Pupil Labs Real-Time Python API Client
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pupil-labs/pl-realtime-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pupil-labs/pl-realtime-api
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/simple-vs-async-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple vs Async API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Simple API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Simple API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/connect-to-a-device/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connect to a Device
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/remote-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Streaming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Streaming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/gaze/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream Gaze
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/scene-camera/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scene Camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/eye-cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eye Cameras
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/imu-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IMU Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/eye-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blinks, Fixations & Saccades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/streaming/audio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Audio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simple/others/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Async API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Async API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../connect-to-a-device/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connect to a Device
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../remote-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Streaming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Streaming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gaze/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream Gaze
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scene-camera/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scene Camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eye-cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eye Cameras
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imu-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IMU Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eye-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blinks, Fixations & Saccades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Audio
    
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../others/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/simple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple API reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api/async/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async API reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/under-the-hood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Under the Hood
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../cookbook/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cookbook
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Cookbook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cookbook/track-your-experiment-progress-using-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track Your Experiment Progress Using Events
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/pupil-labs/pl-realtime-api/edit/main/docs/methods/async/streaming/audio.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="stream-audio">Stream Audio<a class="headerlink" href="#stream-audio" title="Permanent link">&para;</a></h1>
<p><span class="mdx-badge mdx-badge--product" title="Only available for: Neon"><span class="mdx-badge__icon"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></span><span class="mdx-badge__text">Neon</span></span>
<span class="mdx-badge mdx-badge--companion" title="Companion App version: +2.8.31"><span class="mdx-badge__icon"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 19H7V5h10m0-4H7c-1.11 0-2 .89-2 2v18a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2"/></svg></span></span><span class="mdx-badge__text">+2.8.31</span></span>
<span class="mdx-badge mdx-badge--version" title="Minimum Real-Time API version: +1.7"><span class="mdx-badge__icon"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg></span></span><span class="mdx-badge__text">+1.7</span></span></p>
<p>Using the <a class="autorefs autorefs-internal" title="            receive_audio_frames


  
      async
  " href="../../../../modules/#pupil_labs.realtime_api.receive_audio_frames"><code>receive_audio_frames</code></a> method, you can receive audio frames, which you can use it to listen live, record, or perform real-time analysis like speech-to-text or sound analysis.</p>
<p>The data returned is an instance of <a class="autorefs autorefs-internal" title="            AudioFrame" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame"><code>AudioFrame</code></a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">AudioFrame</span><span class="p">(</span>
    <span class="n">av_frame</span><span class="o">=&lt;</span><span class="n">av</span><span class="o">.</span><span class="n">AudioFrame</span> <span class="n">pts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1024</span> <span class="n">samples</span> <span class="n">at</span> <span class="mi">8000</span><span class="n">Hz</span><span class="p">,</span> <span class="n">mono</span><span class="p">,</span> <span class="n">fltp</span> <span class="n">at</span> <span class="mh">0x1189e0ac0</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">timestamp_unix_seconds</span><span class="o">=</span><span class="mf">1758211800.8221593</span><span class="p">,</span>
    <span class="n">resampler</span><span class="o">=&lt;</span><span class="n">av</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">resampler</span><span class="o">.</span><span class="n">AudioResampler</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x1189e04c0</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>
<details class="quote">
<summary>AudioFrame</summary>


<div class="doc doc-object doc-class">



<h1 id="pupil_labs.realtime_api.streaming.audio.AudioFrame" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AudioFrame</span>


<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame" class="headerlink" title="Permanent link">&para;</a></h1>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="typing.NamedTuple" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple">NamedTuple</a></code></p>


        <p>An audio frame with timestamp information.</p>
<p>This class represents an audio frame from the audio stream with associated
timestamp information. The Class inherits AudioFrame from py.av library.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Audio in Neon is streamed as fltp mono 8K, this class takes the decoded packets
as av.AudioFrames.</p>
</details>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            to_ndarray (pupil_labs.realtime_api.streaming.audio.AudioFrame.to_ndarray)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_ndarray">to_ndarray</a></code></b>
            –
            <div class="doc-md-description">
              <p>Convert the audio frame to a NumPy array.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            to_resampled_ndarray (pupil_labs.realtime_api.streaming.audio.AudioFrame.to_resampled_ndarray)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_resampled_ndarray">to_resampled_ndarray</a></code></b>
            –
            <div class="doc-md-description">
              <p>Convert the audio frame to a resampled s16 NumPy array</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            av_frame


  
      instance-attribute
   (pupil_labs.realtime_api.streaming.audio.AudioFrame.av_frame)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.av_frame">av_frame</a></code></b>
              (<code><span title="av.AudioFrame">AudioFrame</span></code>)
          –
          <div class="doc-md-description">
            <p>The audio frame.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            datetime


  
      property
   (pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime">datetime</a></code></b>
              (<code><span title="pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime.datetime">datetime</span></code>)
          –
          <div class="doc-md-description">
            <p>Get timestamp as a datetime object.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            resampler


  
      instance-attribute
   (pupil_labs.realtime_api.streaming.audio.AudioFrame.resampler)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.resampler">resampler</a></code></b>
              (<code><span title="av.AudioResampler">AudioResampler</span></code>)
          –
          <div class="doc-md-description">
            <p>A reference to a shared AudioResampler instance.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            timestamp_unix_ns


  
      property
   (pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_ns)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_ns">timestamp_unix_ns</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            <p>Get timestamp in nanoseconds since Unix epoch.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="            timestamp_unix_seconds


  
      instance-attribute
   (pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_seconds)" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_seconds">timestamp_unix_seconds</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          –
          <div class="doc-md-description">
            <p>Timestamp in seconds since Unix epoch.</p>
          </div>
        </li>
    </ul>




  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.av_frame" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">av_frame</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.av_frame" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">av_frame</span><span class="p">:</span> <span class="n"><span title="av.AudioFrame">AudioFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The audio frame.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">datetime</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">datetime</span><span class="p">:</span> <span class="n"><span title="pupil_labs.realtime_api.streaming.audio.AudioFrame.datetime.datetime">datetime</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get timestamp as a datetime object.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.resampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">resampler</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.resampler" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">resampler</span><span class="p">:</span> <span class="n"><span title="av.AudioResampler">AudioResampler</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A reference to a shared AudioResampler instance.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_ns" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">timestamp_unix_ns</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_ns" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">timestamp_unix_ns</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get timestamp in nanoseconds since Unix epoch.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_seconds" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">timestamp_unix_seconds</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.timestamp_unix_seconds" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">timestamp_unix_seconds</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Timestamp in seconds since Unix epoch.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.to_ndarray" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_ndarray</span>


<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_ndarray" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_ndarray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="numpy.typing.NDArray">NDArray</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert the audio frame to a NumPy array.</p>


            <details class="quote">
              <summary>Source code in <code>src/pupil_labs/realtime_api/streaming/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_ndarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the audio frame to a NumPy array.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">to_ndarray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pupil_labs.realtime_api.streaming.audio.AudioFrame.to_resampled_ndarray" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_resampled_ndarray</span>


<a href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_resampled_ndarray" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_resampled_ndarray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Iterator" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator">Iterator</a></span><span class="p">[</span><span class="n"><span title="numpy.typing.NDArray">NDArray</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert the audio frame to a resampled s16 NumPy array</p>


            <details class="quote">
              <summary>Source code in <code>src/pupil_labs/realtime_api/streaming/audio.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_resampled_ndarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the audio frame to a resampled s16 NumPy array&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resampler</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">av_frame</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">frame</span><span class="o">.</span><span class="n">to_ndarray</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></details>
<p>By default, audio is streamed in <strong>mono</strong> using the <strong>AAC codec</strong>. The stream is downsampled from the original 48 kHz source to a sampling rate of <strong>8 kHz</strong> to save bandwidth, and uses a <strong>32-bit floating-point planar (fltp)</strong> format.</p>
<p>The audio stream does not have it's own RTSP stream but is <strong>multiplexed</strong> with video, we create a virtual sensor component using the Scene Camera stream.</p>
<h2 id="working-with-audio-data">Working with Audio Data<a class="headerlink" href="#working-with-audio-data" title="Permanent link">&para;</a></h2>
<p>You can easily receive audio frames and convert them to NumPy arrays using the <a class="autorefs autorefs-internal" title="            to_ndarray" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_ndarray"><code>to_ndarray</code></a> method and feed these to any audio library of your choice like <a href="https://librosa.org/"><code>librosa</code></a> for analysis.</p>
<details class="example">
<summary>Check the whole example code here</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">stream_audio.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pupil_labs.realtime_api</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Device</span><span class="p">,</span>
    <span class="n">Network</span><span class="p">,</span>
    <span class="n">receive_audio_frames</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">network</span><span class="p">:</span>
            <span class="n">dev_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">network</span><span class="o">.</span><span class="n">wait_for_new_device</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dev_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No device could be found! Aborting.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">async</span> <span class="k">with</span> <span class="n">Device</span><span class="o">.</span><span class="n">from_discovered_device</span><span class="p">(</span><span class="n">dev_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="n">device</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

                <span class="n">sensor_audio</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_audio_sensor</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sensor_audio</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio sensor is not connected to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">. Aborting.&quot;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">audio_generator</span> <span class="o">=</span> <span class="n">receive_audio_frames</span><span class="p">(</span><span class="n">sensor_audio</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">first_frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">anext</span><span class="p">(</span><span class="n">audio_generator</span><span class="p">)</span>
                <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">nb_channels</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Audio stream parameters: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Sample Rate: </span><span class="si">{</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Channels: </span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Layout: </span><span class="si">{</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">audio_frame</span> <span class="ow">in</span> <span class="n">audio_generator</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">audio_frame</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Main task cancelled.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;KeyboardInterrupt received, initiating shutdown.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up resources...&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Use contextlib.suppress to avoid a traceback on KeyboardInterrupt</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">):</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
<p>For completeness, we have also included an example that shows how plot audio using librosa and rich on the terminal.</p>
<figure>
<img alt="Audio Wave" loading="lazy" src="../../../../assets/audio_wave.webp" />
</figure>
<details class="example">
<summary>Check the whole example code here</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">stream_audio_spectrum.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">librosa</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
        <span class="s2">&quot;librosa library not found. Please install with: pip install librosa to run&quot;</span>
        <span class="s2">&quot;this example or install pl-realtime with examples extras: &quot;</span>
        <span class="s2">&quot;pip install pupil-labs-realtime-api[examples]&quot;</span>
        <span class="s2">&quot;uv pip install pupil-labs-realtime-api --group examples&quot;</span>
    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.align</span><span class="w"> </span><span class="kn">import</span> <span class="n">Align</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.live</span><span class="w"> </span><span class="kn">import</span> <span class="n">Live</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">Panel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pupil_labs.realtime_api</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Device</span><span class="p">,</span>
    <span class="n">Network</span><span class="p">,</span>
    <span class="n">receive_audio_frames</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TerminalAudioBar</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">min_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span> <span class="o">=</span> <span class="n">max_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_level</span> <span class="o">=</span> <span class="n">min_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="n">max_level</span>
        <span class="n">level_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_level</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_level</span>
        <span class="n">height_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__level_height_ratio</span> <span class="o">=</span> <span class="n">height_range</span> <span class="o">/</span> <span class="n">level_range</span> <span class="k">if</span> <span class="n">level_range</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">desired_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__level_height_ratio</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="p">(</span><span class="n">desired_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_linear_spectrum</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">bars</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a linear, vertically symmetric bar spectrum.&quot;&quot;&quot;</span>
    <span class="n">audio_chunk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">audio_chunk</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="n">stft_data</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">audio_chunk</span><span class="p">)</span>
    <span class="n">stft_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">stft_data</span><span class="p">)</span>
    <span class="n">n_fft</span> <span class="o">=</span> <span class="p">(</span><span class="n">stft_magnitude</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">fft_frequencies</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[:</span> <span class="n">stft_magnitude</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
        <span class="n">freq_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">freqs</span> <span class="o">-</span> <span class="n">bar</span><span class="o">.</span><span class="n">target_freq</span><span class="p">))</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stft_magnitude</span><span class="p">[</span><span class="n">freq_index</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="n">term_size_obj</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">term_size_obj</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

    <span class="n">center_y</span> <span class="o">=</span> <span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">output_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">row_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
        <span class="n">row_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
            <span class="n">half_height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">is_filled_down</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">&lt;=</span> <span class="n">row_idx</span> <span class="o">&lt;</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">half_height</span>
            <span class="n">is_filled_up</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">&gt;</span> <span class="n">row_idx</span> <span class="o">&gt;=</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">half_height</span>

            <span class="k">if</span> <span class="n">is_filled_up</span> <span class="ow">or</span> <span class="n">is_filled_down</span><span class="p">:</span>
                <span class="n">row_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;█&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">bar</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="n">output_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_text</span><span class="p">)</span>
        <span class="n">output_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_text</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">network</span><span class="p">:</span>
        <span class="n">dev_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">network</span><span class="o">.</span><span class="n">wait_for_new_device</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dev_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No device could be found! Abort&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">Device</span><span class="o">.</span><span class="n">from_discovered_device</span><span class="p">(</span><span class="n">dev_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting status information from </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="n">device</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

        <span class="n">sensor_audio</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_audio_sensor</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sensor_audio</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio sensor is not connected to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">audio_generator</span> <span class="o">=</span> <span class="n">receive_audio_frames</span><span class="p">(</span><span class="n">sensor_audio</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Prime the generator to get the first frame for parameters</span>
        <span class="n">first_frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">anext</span><span class="p">(</span><span class="n">audio_generator</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Audio stream parameters: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Sample Rate: </span><span class="si">{</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Channels: </span><span class="si">{</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">nb_channels</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Layout: </span><span class="si">{</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>

        <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TerminalAudioBar</span><span class="p">(</span>
                <span class="n">target_freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">last_ts</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">timestamp_unix_seconds</span>
        <span class="k">with</span> <span class="n">Live</span><span class="p">(</span><span class="n">auto_refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vertical_overflow</span><span class="o">=</span><span class="s2">&quot;visible&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">live</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">audio_frame</span> <span class="ow">in</span> <span class="n">receive_audio_frames</span><span class="p">(</span>
                <span class="n">sensor_audio</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">):</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">audio_frame</span><span class="o">.</span><span class="n">timestamp_unix_seconds</span> <span class="o">-</span> <span class="n">last_ts</span>
                <span class="n">last_ts</span> <span class="o">=</span> <span class="n">audio_frame</span><span class="o">.</span><span class="n">timestamp_unix_seconds</span>
                <span class="n">aframe_ndarray</span> <span class="o">=</span> <span class="n">audio_frame</span><span class="o">.</span><span class="n">to_ndarray</span><span class="p">()</span>

                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">generate_linear_spectrum</span><span class="p">(</span>
                    <span class="n">aframe_ndarray</span><span class="p">,</span>
                    <span class="n">sample_rate</span><span class="o">=</span><span class="n">audio_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">,</span>
                    <span class="n">bars</span><span class="o">=</span><span class="n">bars</span><span class="p">,</span>
                    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">display_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span>
                    <span class="n">Align</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">),</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[bold cyan]Live Audio Waveform[/bold cyan]&quot;</span><span class="p">,</span>
                    <span class="n">border_style</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
                    <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">live</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">display_panel</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Keep the main asyncio loop running until interrupted</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Main task cancelled.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;KeyboardInterrupt received.&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">):</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="playing-audio">Playing Audio<a class="headerlink" href="#playing-audio" title="Permanent link">&para;</a></h2>
<p>Audio Playback in realtime can be tricky, here we use <a href="https://python-sounddevice.readthedocs.io/">SoundDevice</a>. This library digest NumPy arrays and allows to play them back quickly. The only caveat is that it does not accept 32 bit planar audio format, thus, we have to resample it.</p>
<p>For commodity, we included a PyAv <code>AudioResampler</code> object to the AudioFrame class, it lazy loads, and calling <a class="autorefs autorefs-internal" title="            to_resampled_ndarray" href="#pupil_labs.realtime_api.streaming.audio.AudioFrame.to_resampled_ndarray"><code>to_resampled_ndarray</code></a> will convert convert the av.AudioFrame to a NumPy array in signed 16-bit integer format, which is supported by SoundDevice for playback.</p>
<p>To simplify development and ensure audio does not block your application, the examples include an <a class="autorefs autorefs-internal" title="            AudioPlayer" href="#audio_player.AudioPlayer"><code>AudioPlayer</code></a> class. It handles audio buffering and playback in a background process, using a circular buffer to guarantee smooth playback without glitches or silence.</p>
<details class="example">
<summary>Check the whole example code here</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">stream_audio_and_play.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">T</span>

<span class="c1"># Allow for absloute imports, to import audio_player from the parent directory.</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">)))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">audio_player</span><span class="w"> </span><span class="kn">import</span> <span class="n">AudioPlayer</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pupil_labs.realtime_api</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AudioFrame</span><span class="p">,</span>
    <span class="n">Device</span><span class="p">,</span>
    <span class="n">Network</span><span class="p">,</span>
    <span class="n">receive_audio_frames</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">enqueue_audio_data</span><span class="p">(</span>
    <span class="n">audio_generator</span><span class="p">:</span> <span class="n">T</span><span class="o">.</span><span class="n">AsyncIterator</span><span class="p">[</span><span class="n">AudioFrame</span><span class="p">],</span>
    <span class="n">player</span><span class="p">:</span> <span class="n">AudioPlayer</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get audio frames from a generator, resample and put them into a queue.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio enqueuer task started.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">audio_frame</span> <span class="ow">in</span> <span class="n">audio_generator</span><span class="p">:</span>
            <span class="c1"># We place the resampled ndarray (s16) in the queue</span>
            <span class="c1"># for the audio callback to consume.</span>
            <span class="k">for</span> <span class="n">resampled_chunk</span> <span class="ow">in</span> <span class="n">audio_frame</span><span class="o">.</span><span class="n">to_resampled_ndarray</span><span class="p">():</span>
                <span class="n">player</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">resampled_chunk</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio enqueuer task cancelled.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An error occurred in the audio enqueuer task.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio enqueuer task finished. Signaling end of stream.&quot;</span><span class="p">)</span>
        <span class="n">player</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Signal the audio playback thread to stop</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">network</span><span class="p">:</span>
            <span class="n">dev_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">network</span><span class="o">.</span><span class="n">wait_for_new_device</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dev_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No device could be found! Aborting.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">async</span> <span class="k">with</span> <span class="n">Device</span><span class="o">.</span><span class="n">from_discovered_device</span><span class="p">(</span><span class="n">dev_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="n">device</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

                <span class="n">sensor_audio</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_audio_sensor</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sensor_audio</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio sensor is not connected to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">. Aborting.&quot;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">audio_generator</span> <span class="o">=</span> <span class="n">receive_audio_frames</span><span class="p">(</span><span class="n">sensor_audio</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">first_frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">anext</span><span class="p">(</span><span class="n">audio_generator</span><span class="p">)</span>
                <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">nb_channels</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Audio stream parameters: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Sample Rate: </span><span class="si">{</span><span class="n">sample_rate</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Channels: </span><span class="si">{</span><span class="n">channels</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Layout: </span><span class="si">{</span><span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">player</span> <span class="o">=</span> <span class="n">AudioPlayer</span><span class="p">(</span>
                    <span class="n">samplerate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
                    <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">player</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

                <span class="c1"># Start the asyncio task to enqueue audio data from the generator</span>
                <span class="n">enqueue_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                    <span class="n">enqueue_audio_data</span><span class="p">(</span><span class="n">audio_generator</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Prime the queue with the first frame we already extracted</span>
                <span class="k">for</span> <span class="n">resampled_chunk</span> <span class="ow">in</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">to_resampled_ndarray</span><span class="p">():</span>
                    <span class="n">player</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">resampled_chunk</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

                <span class="c1"># Wait for the enqueuer task to complete or be cancelled</span>
                <span class="k">await</span> <span class="n">enqueue_task</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Main task cancelled.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;KeyboardInterrupt received, initiating shutdown.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up resources...&quot;</span><span class="p">)</span>
        <span class="n">player</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleanup complete.&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Use contextlib.suppress to avoid a traceback on KeyboardInterrupt</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">):</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="playing-video-and-audio">Playing Video and Audio<a class="headerlink" href="#playing-video-and-audio" title="Permanent link">&para;</a></h2>
<p>Here you can find an example that shows how to play both video with gaze overlay and audio using OpenCV and SoundDevice. Note that this is a example uses threading to handle both video and audio playback, which is not optimal, but works for demonstration purposes.</p>
<details class="example">
<summary>Check the whole example code here</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">stream_video_gaze_and_audio.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">T</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">Queue</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sounddevice</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pupil_labs.realtime_api</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Device</span><span class="p">,</span>
    <span class="n">Network</span><span class="p">,</span>
    <span class="n">receive_audio_frames</span><span class="p">,</span>
    <span class="n">receive_gaze_data</span><span class="p">,</span>
    <span class="n">receive_video_frames</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Use a threading event to signal the audio playback thread to stop</span>
<span class="n">stop_audio_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

<span class="c1"># OpenCV workaround for a known issue</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;cv/av bug&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">audio_playback_thread_target</span><span class="p">(</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">stop_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span>
    <span class="n">audio_queue</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dedicated thread for sounddevice playback.</span>

<span class="sd">    This runs in a separate thread to avoid blocking the main asyncio event loop.</span>
<span class="sd">    It receives raw AudioFrames, resamples them, and plays them back.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio playback thread started.&quot;</span><span class="p">)</span>
    <span class="n">audio_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">audio_callback</span><span class="p">(</span><span class="n">outdata</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">],</span> <span class="n">frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">audio_buffer</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_buffer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">frames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">audio_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">sd</span><span class="o">.</span><span class="n">CallbackStop</span><span class="p">(</span><span class="s2">&quot;End of stream.&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">resampled_chunk</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">to_resampled_ndarray</span><span class="p">():</span>
                    <span class="n">audio_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                        <span class="n">audio_buffer</span><span class="p">,</span>
                        <span class="n">resampled_chunk</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="p">))</span>
            <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Audio buffer underrun: filling with silence.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="n">frames_to_play</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">audio_buffer</span><span class="p">),</span> <span class="n">frames</span><span class="p">)</span>
        <span class="n">outdata</span><span class="p">[:</span><span class="n">frames_to_play</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio_buffer</span><span class="p">[:</span><span class="n">frames_to_play</span><span class="p">]</span>
        <span class="n">outdata</span><span class="p">[</span><span class="n">frames_to_play</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">audio_buffer</span> <span class="o">=</span> <span class="n">audio_buffer</span><span class="p">[</span><span class="n">frames_to_play</span><span class="p">:]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">,</span>
            <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int16&quot;</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">audio_callback</span><span class="p">,</span>
            <span class="n">blocksize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">latency</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio stream started.&quot;</span><span class="p">)</span>
            <span class="n">stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stop signal received, closing audio stream.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;An error occurred in the audio playback thread.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio playback thread finished.&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manage_audio_playback</span><span class="p">(</span>
    <span class="n">queue_audio</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span> <span class="n">audio_playback_queue</span><span class="p">:</span> <span class="n">Queue</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Audio management task.</span>

<span class="sd">    Waits for the first audio frame, starts the playback thread,</span>
<span class="sd">    and then continuously moves frames from the asyncio queue to the thread&#39;s queue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">audio_playback_thread</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Wait for the first frame to arrive to start the playback thread</span>
        <span class="n">_ts</span><span class="p">,</span> <span class="n">first_frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue_audio</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First audio frame received, starting playback thread.&quot;</span><span class="p">)</span>

        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">first_frame</span><span class="o">.</span><span class="n">av_frame</span><span class="o">.</span><span class="n">sample_rate</span>
        <span class="n">audio_playback_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">audio_playback_thread_target</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">,</span> <span class="n">stop_audio_event</span><span class="p">,</span> <span class="n">audio_playback_queue</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AudioPlaybackThread&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">audio_playback_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Put the first frame into the playback queue</span>
        <span class="n">audio_playback_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">first_frame</span><span class="p">)</span>

        <span class="c1"># Continuously move frames from the async queue to the playback queue</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_audio_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="n">_ts</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue_audio</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">audio_playback_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio manager task cancelled.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">audio_playback_thread</span> <span class="ow">and</span> <span class="n">audio_playback_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="c1"># Signal end of stream to the audio thread</span>
            <span class="n">audio_playback_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio manager task finished.&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">enqueue_sensor_data</span><span class="p">(</span><span class="n">sensor</span><span class="p">:</span> <span class="n">T</span><span class="o">.</span><span class="n">AsyncIterator</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Move sensor data into an asyncio queue.&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">sensor</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">((</span><span class="n">datum</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datum</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueFull</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Queue is full, dropping </span><span class="si">{</span><span class="n">datum</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_most_recent_item</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Empty the queue and returns the last item.&quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_item</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">next_item</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_closest_item</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the item from the queue that is closest in time to the timestamp.&quot;&quot;&quot;</span>
    <span class="n">item_ts</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">item_ts</span> <span class="o">&gt;</span> <span class="n">timestamp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item_ts</span><span class="p">,</span> <span class="n">item</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_item_ts</span><span class="p">,</span> <span class="n">next_item</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item_ts</span><span class="p">,</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">next_item_ts</span> <span class="o">&gt;</span> <span class="n">timestamp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">next_item_ts</span><span class="p">,</span> <span class="n">next_item</span>
            <span class="n">item_ts</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">next_item_ts</span><span class="p">,</span> <span class="n">next_item</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">match_and_draw</span><span class="p">(</span><span class="n">queue_video</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span> <span class="n">queue_gaze</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Match video and gaze data and draws the gaze overlay.&quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_audio_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">video_datetime</span><span class="p">,</span> <span class="n">video_frame</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_most_recent_item</span><span class="p">(</span><span class="n">queue_video</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">gaze_datum</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_closest_item</span><span class="p">(</span><span class="n">queue_gaze</span><span class="p">,</span> <span class="n">video_datetime</span><span class="p">)</span>

            <span class="n">bgr_buffer</span> <span class="o">=</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">to_ndarray</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;bgr24&quot;</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
                <span class="n">bgr_buffer</span><span class="p">,</span>
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">gaze_datum</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">gaze_datum</span><span class="o">.</span><span class="n">y</span><span class="p">)),</span>
                <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
                <span class="n">thickness</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Scene Camera with Gaze and Audio&quot;</span><span class="p">,</span> <span class="n">bgr_buffer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;q&#39; pressed, exiting.&quot;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
            <span class="c1"># Queues might be empty at the start, just continue</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error in drawing loop&quot;</span><span class="p">)</span>
            <span class="k">break</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">network</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dev_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">network</span><span class="o">.</span><span class="n">wait_for_new_device</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dev_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No device found. Aborting.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Timeout while searching for a device. Aborting.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">Device</span><span class="o">.</span><span class="n">from_discovered_device</span><span class="p">(</span><span class="n">dev_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="n">device</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

            <span class="n">sensor_world</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_world_sensor</span><span class="p">()</span>
            <span class="n">sensor_gaze</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_gaze_sensor</span><span class="p">()</span>
            <span class="n">sensor_audio</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">direct_audio_sensor</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">connected</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sensor_world</span><span class="p">,</span> <span class="n">sensor_gaze</span><span class="p">,</span> <span class="n">sensor_audio</span><span class="p">]):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Not all required sensors are connected. Aborting.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All sensors connected.&quot;</span><span class="p">)</span>
            <span class="n">restart_on_disconnect</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Initialize Queues</span>
            <span class="n">queue_video</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
            <span class="n">queue_gaze</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
            <span class="n">queue_audio</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
            <span class="n">audio_playback_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>  <span class="c1"># For communication with the audio thread</span>

            <span class="c1"># Create tasks for receiving and processing data</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">audio_playback_thread</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Sensor data enqueuing tasks</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                        <span class="n">enqueue_sensor_data</span><span class="p">(</span>
                            <span class="n">receive_video_frames</span><span class="p">(</span>
                                <span class="n">sensor_world</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="n">restart_on_disconnect</span>
                            <span class="p">),</span>
                            <span class="n">queue_video</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                        <span class="n">enqueue_sensor_data</span><span class="p">(</span>
                            <span class="n">receive_gaze_data</span><span class="p">(</span>
                                <span class="n">sensor_gaze</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="n">restart_on_disconnect</span>
                            <span class="p">),</span>
                            <span class="n">queue_gaze</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                        <span class="n">enqueue_sensor_data</span><span class="p">(</span>
                            <span class="n">receive_audio_frames</span><span class="p">(</span>
                                <span class="n">sensor_audio</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="n">restart_on_disconnect</span>
                            <span class="p">),</span>
                            <span class="n">queue_audio</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">))</span>

                <span class="c1"># Audio management task</span>
                <span class="n">audio_manager_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                    <span class="n">manage_audio_playback</span><span class="p">(</span><span class="n">queue_audio</span><span class="p">,</span> <span class="n">audio_playback_queue</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">audio_manager_task</span><span class="p">)</span>

                <span class="c1"># Run the main drawing loop</span>
                <span class="k">await</span> <span class="n">match_and_draw</span><span class="p">(</span><span class="n">queue_video</span><span class="p">,</span> <span class="n">queue_gaze</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shutting down...&quot;</span><span class="p">)</span>
                <span class="n">stop_audio_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                    <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Find the audio thread to join it</span>
                <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threading</span><span class="o">.</span><span class="n">enumerate</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AudioPlaybackThread&quot;</span><span class="p">:</span>
                        <span class="n">audio_playback_thread</span> <span class="o">=</span> <span class="n">thread</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">audio_playback_thread</span> <span class="ow">and</span> <span class="n">audio_playback_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                    <span class="c1"># Put a final None to ensure the audio thread&#39;s queue.get() unblocks</span>
                    <span class="n">audio_playback_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">audio_playback_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">audio_playback_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Audio thread did not terminate cleanly.&quot;</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleanup complete.&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">):</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
<p>Alternatively, have a look at our simple examples, to see how to leverage <a class="autorefs autorefs-internal" title="            AudioPlayer" href="#audio_player.AudioPlayer"><code>AudioPlayer</code></a>, which already uses a separate process.</p>
<details class="quote">
<summary>AudioPlayer</summary>


<div class="doc doc-object doc-class">



<h1 id="audio_player.AudioPlayer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">AudioPlayer</span>


<a href="#audio_player.AudioPlayer" class="headerlink" title="Permanent link">&para;</a></h1>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">AudioPlayer</span><span class="p">(</span><span class="n">samplerate</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;int16&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="threading.Thread" href="https://docs.python.org/3/library/threading.html#threading.Thread">Thread</a></code></p>


        <p>A threaded, low-latency audio player using a shared RingBuffer.</p>










<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            add_data (audio_player.AudioPlayer.add_data)" href="#audio_player.AudioPlayer.add_data">add_data</a></code></b>
            –
            <div class="doc-md-description">
              <p>Directly write data to the shared RingBuffer.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            close (audio_player.AudioPlayer.close)" href="#audio_player.AudioPlayer.close">close</a></code></b>
            –
            <div class="doc-md-description">
              <p>Signal the thread to stop and clean up resources.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            get_buffer_size (audio_player.AudioPlayer.get_buffer_size)" href="#audio_player.AudioPlayer.get_buffer_size">get_buffer_size</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the current number of samples in the buffer for debugging.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="            run (audio_player.AudioPlayer.run)" href="#audio_player.AudioPlayer.run">run</a></code></b>
            –
            <div class="doc-md-description">
              <p>Run the main entrypoint for the thread.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>examples/audio_player.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplerate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;int16&quot;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samplerate</span> <span class="o">=</span> <span class="n">samplerate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">RingBuffer</span><span class="p">(</span>
        <span class="n">capacity</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
        <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="audio_player.AudioPlayer.add_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_data</span>


<a href="#audio_player.AudioPlayer.add_data" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n"><span title="numpy.typing.NDArray">NDArray</span></span><span class="p">[</span><span class="n"><span title="numpy.int16">int16</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Directly write data to the shared RingBuffer.</p>


            <details class="quote">
              <summary>Source code in <code>examples/audio_player.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Directly write data to the shared RingBuffer.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="audio_player.AudioPlayer.close" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">close</span>


<a href="#audio_player.AudioPlayer.close" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">close</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Signal the thread to stop and clean up resources.</p>


            <details class="quote">
              <summary>Source code in <code>examples/audio_player.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Signal the thread to stop and clean up resources.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Closing audio player...&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># Wait for the thread to finish</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Audio player closed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="audio_player.AudioPlayer.get_buffer_size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_buffer_size</span>


<a href="#audio_player.AudioPlayer.get_buffer_size" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_buffer_size</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the current number of samples in the buffer for debugging.</p>


            <details class="quote">
              <summary>Source code in <code>examples/audio_player.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_buffer_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current number of samples in the buffer for debugging.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="audio_player.AudioPlayer.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#audio_player.AudioPlayer.run" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run the main entrypoint for the thread.</p>


            <details class="quote">
              <summary>Source code in <code>examples/audio_player.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the main entrypoint for the thread.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samplerate</span><span class="p">,</span>
            <span class="n">channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">,</span>
            <span class="n">blocksize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Let the device choose the optimal size for low latency</span>
            <span class="n">latency</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Audio stream started.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># Wait until the close() method is called</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error in audio thread.&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Audio stream closed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></details>
<div class="admonition tip">
<p class="admonition-title">Bonus</p>
<p>On the simple API examples you can also find how to use the audio for Speech-to-Text using the <code>whisper</code> library.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../eye-events/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Blinks, Fixations &amp; Saccades">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Blinks, Fixations & Saccades
              </div>
            </div>
          </a>
        
        
          
          <a href="../../templates/" class="md-footer__link md-footer__link--next" aria-label="Next: Templates">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Templates
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/pupil-labs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/pupil-labs-realtime-api/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pupil-labs.com/chat" target="_blank" rel="noopener" title="pupil-labs.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pupil-labs.com/" target="_blank" rel="noopener" title="pupil-labs.com" class="md-social__link">
      <svg xml:space="preserve" viewBox="0 0 512 512">
	<path d="M256.01 0C114.615 0 0 114.617 0 256c0 141.384 114.616 256 256.01 256C397.383 512 512 397.384 512 256 512 114.617 397.384 0 256.01 0zm-.02 457.029c-110.842 0-201.011-90.17-201.011-201.012S145.149 54.971 255.99 54.971c110.843 0 201.048 90.204 201.048 201.046S366.833 457.03 255.99 457.03z" class="st4"/>
	<path d="M255.99 73.033c-100.893 0-182.949 82.091-182.949 182.984 0 100.895 82.056 182.95 182.95 182.95 100.893 0 182.985-82.055 182.985-182.95 0-100.893-82.092-182.984-182.986-182.984zM256.01 384c-70.698 0-128.006-57.308-128.006-128 0-70.697 57.308-128.006 128.005-128.006 70.696 0 128.003 57.31 128.003 128.006 0 70.692-57.307 128-128.003 128z" class="st4"/>
</svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.code.copy", "content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../../assets/_markdown_exec_pyodide.js"></script>
      
    
  </body>
</html>